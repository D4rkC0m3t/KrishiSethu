<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Configuration Test</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-item {
            margin: 15px 0;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #ccc;
        }
        .success {
            background-color: #d4edda;
            border-left-color: #28a745;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border-left-color: #dc3545;
            color: #721c24;
        }
        .warning {
            background-color: #fff3cd;
            border-left-color: #ffc107;
            color: #856404;
        }
        .info {
            background-color: #d1ecf1;
            border-left-color: #17a2b8;
            color: #0c5460;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî• Firebase Configuration Test</h1>
        <p>This will test your Firebase project configuration and help identify issues.</p>

        <button onclick="runAllTests()">Run All Tests</button>
        <button onclick="testAuth()">Test Authentication Only</button>
        <button onclick="testFirestore()">Test Firestore Only</button>

        <div id="results"></div>

        <div class="warning" style="margin-top: 30px;">
            <h3>üìã Setup Checklist</h3>
            <p>If tests fail, make sure you have:</p>
            <ul>
                <li>‚úÖ Enabled Authentication in Firebase Console</li>
                <li>‚úÖ Enabled Email/Password sign-in method</li>
                <li>‚úÖ Created Firestore database</li>
                <li>‚úÖ Set appropriate security rules</li>
            </ul>
        </div>

        <div class="info" style="margin-top: 20px;">
            <h3>üîß Quick Fixes</h3>
            <p><strong>If Authentication is not enabled:</strong></p>
            <ol>
                <li>Go to <a href="https://console.firebase.google.com/project/krishisetu-88b88/authentication" target="_blank">Firebase Console ‚Üí Authentication</a></li>
                <li>Click "Get started" if you see it</li>
                <li>Go to "Sign-in method" tab</li>
                <li>Enable "Email/Password"</li>
            </ol>
            
            <p><strong>If Firestore is not enabled:</strong></p>
            <ol>
                <li>Go to <a href="https://console.firebase.google.com/project/krishisetu-88b88/firestore" target="_blank">Firebase Console ‚Üí Firestore</a></li>
                <li>Click "Create database"</li>
                <li>Choose "Start in production mode"</li>
                <li>Select a location (asia-southeast1 recommended)</li>
            </ol>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCP7F9rGrvmquvDieiLZ1qahOo2dMXJ-WY",
            authDomain: "krishisetu-88b88.firebaseapp.com",
            projectId: "krishisetu-88b88",
            storageBucket: "krishisetu-88b88.firebasestorage.app",
            messagingSenderId: "1097162834618",
            appId: "1:1097162834618:web:0fbda0a418ef114109b883"
        };

        let results = document.getElementById('results');

        function addResult(title, status, message, details = '') {
            const className = status === 'success' ? 'success' : status === 'error' ? 'error' : status === 'warning' ? 'warning' : 'info';
            const icon = status === 'success' ? '‚úÖ' : status === 'error' ? '‚ùå' : status === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            
            results.innerHTML += `
                <div class="test-item ${className}">
                    <h4>${icon} ${title}</h4>
                    <p>${message}</p>
                    ${details ? `<pre>${details}</pre>` : ''}
                </div>
            `;
        }

        function clearResults() {
            results.innerHTML = '';
        }

        async function testFirebaseInit() {
            try {
                firebase.initializeApp(firebaseConfig);
                addResult('Firebase Initialization', 'success', 'Firebase app initialized successfully');
                return true;
            } catch (error) {
                addResult('Firebase Initialization', 'error', 'Failed to initialize Firebase', error.message);
                return false;
            }
        }

        async function testAuth() {
            try {
                const auth = firebase.auth();
                addResult('Authentication Service', 'success', 'Firebase Auth service is available');
                
                // Test auth configuration
                try {
                    await auth.fetchSignInMethodsForEmail('test@example.com');
                    addResult('Authentication Configuration', 'success', 'Authentication is properly configured');
                } catch (error) {
                    if (error.code === 'auth/configuration-not-found') {
                        addResult('Authentication Configuration', 'error', 
                            'Authentication is not enabled in Firebase Console', 
                            'Go to Firebase Console ‚Üí Authentication ‚Üí Get started ‚Üí Enable Email/Password');
                    } else {
                        addResult('Authentication Configuration', 'warning', 
                            'Authentication test completed with minor issues', error.message);
                    }
                }
                return true;
            } catch (error) {
                addResult('Authentication Service', 'error', 'Firebase Auth service failed', error.message);
                return false;
            }
        }

        async function testFirestore() {
            try {
                const db = firebase.firestore();
                addResult('Firestore Service', 'success', 'Firestore service is available');
                
                // Test Firestore access
                try {
                    await db.collection('test').limit(1).get();
                    addResult('Firestore Access', 'success', 'Firestore database is accessible');
                } catch (error) {
                    if (error.code === 'permission-denied') {
                        addResult('Firestore Access', 'warning', 
                            'Firestore access denied (expected with current security rules)', 
                            'This is normal if you have secure rules. You may need to temporarily allow all access for setup.');
                    } else {
                        addResult('Firestore Access', 'error', 'Firestore access failed', error.message);
                    }
                }
                return true;
            } catch (error) {
                addResult('Firestore Service', 'error', 'Firestore service failed', error.message);
                return false;
            }
        }

        async function testProjectInfo() {
            addResult('Project Information', 'info', 'Current Firebase project configuration', 
                `Project ID: ${firebaseConfig.projectId}\nAuth Domain: ${firebaseConfig.authDomain}\nAPI Key: ${firebaseConfig.apiKey.substring(0, 10)}...`);
        }

        async function runAllTests() {
            clearResults();
            addResult('Starting Tests', 'info', 'Running comprehensive Firebase configuration tests...');
            
            await testProjectInfo();
            
            const initSuccess = await testFirebaseInit();
            if (!initSuccess) return;
            
            await testAuth();
            await testFirestore();
            
            addResult('Tests Complete', 'info', 'All tests completed. Check results above for any issues.');
        }

        // Auto-run tests on page load
        window.onload = function() {
            setTimeout(runAllTests, 1000);
        };
    </script>
</body>
</html>
